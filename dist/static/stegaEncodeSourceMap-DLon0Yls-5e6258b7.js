import{b as W}from"./sanity-9b858e30.js";const R=/_key\s*==\s*['"](.*)['"]/;function D(e){return typeof e=="string"?R.test(e.trim()):typeof e=="object"&&"_key"in e}function x(e){if(!Array.isArray(e))throw new Error("Path is not an array");return e.reduce((t,r,n)=>{const o=typeof r;if(o==="number")return`${t}[${r}]`;if(o==="string")return`${t}${n===0?"":"."}${r}`;if(D(r)&&r._key)return`${t}[_key=="${r._key}"]`;if(Array.isArray(r)){const[s,a]=r;return`${t}[${s}:${a}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(r)}\``)},"")}const S={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},P={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function q(e){return`$${e.map(t=>typeof t=="string"?`['${t.replace(/[\f\n\r\t'\\]/g,n=>S[n])}']`:typeof t=="number"?`[${t}]`:t._key!==""?`[?(@._key=='${t._key.replace(/['\\]/g,n=>S[n])}')]`:`[${t._index}]`).join("")}`}function j(e){const t=[],r=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let n;for(;(n=r.exec(e))!==null;){if(n[1]!==void 0){const o=n[1].replace(/\\(\\|f|n|r|t|')/g,s=>P[s]);t.push(o);continue}if(n[2]!==void 0){t.push(parseInt(n[2],10));continue}if(n[3]!==void 0){const o=n[3].replace(/\\(\\')/g,s=>P[s]);t.push({_key:o,_index:-1});continue}}return t}function I(e){return e.map(t=>{if(typeof t=="string"||typeof t=="number")return t;if(t._key!=="")return{_key:t._key};if(t._index!==-1)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)})}function J(e){return e.map(t=>{if(typeof t=="string"||typeof t=="number")return t;if(t._index!==-1)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)})}function V(e,t){if(!(t!=null&&t.mappings))return;const r=q(J(e));if(t.mappings[r]!==void 0)return{mapping:t.mappings[r],matchedPath:r,pathSuffix:""};const n=Object.entries(t.mappings).filter(([u])=>r.startsWith(u)).sort(([u],[d])=>d.length-u.length);if(n.length==0)return;const[o,s]=n[0],a=r.substring(o.length);return{mapping:s,matchedPath:o,pathSuffix:a}}function B(e){return e!==null&&Array.isArray(e)}function U(e){return typeof e=="object"&&e!==null}function b(e,t,r=[]){return B(e)?e.map((n,o)=>{if(U(n)){const s=n._key;if(typeof s=="string")return b(n,t,r.concat({_key:s,_index:o}))}return b(n,t,r.concat(o))}):U(e)?Object.fromEntries(Object.entries(e).map(([n,o])=>[n,b(o,t,r.concat(n))])):t(e,r)}function G(e,t,r){return b(e,(n,o)=>{if(typeof n!="string")return n;const s=V(o,t);if(!s)return n;const{mapping:a,matchedPath:u}=s;if(a.type!=="value"||a.source.type!=="documentValue")return n;const d=t.documents[a.source.document],p=t.paths[a.source.path],h=j(u),y=j(p).concat(o.slice(h.length));return r({sourcePath:y,sourceDocument:d,resultPath:o,value:n})})}const v="drafts.";function z(e){return e.startsWith(v)?e.slice(v.length):e}function H(e){const{baseUrl:t,workspace:r="default",tool:n="default",id:o,type:s,path:a,projectId:u,dataset:d}=e;if(!t)throw new Error("baseUrl is required");if(!a)throw new Error("path is required");if(!o)throw new Error("id is required");if(t!=="/"&&t.endsWith("/"))throw new Error("baseUrl must not end with a slash");const p=r==="default"?void 0:r,h=n==="default"?void 0:n,_=z(o),y=Array.isArray(a)?x(I(a)):a,i=new URLSearchParams({baseUrl:t,id:_,type:s,path:y});p&&i.set("workspace",p),h&&i.set("tool",h),u&&i.set("projectId",u),d&&i.set("dataset",d);const k=[t==="/"?"":t];p&&k.push(p);const c=["mode=presentation",`id=${_}`,`type=${s}`,`path=${encodeURIComponent(y)}`];return h&&c.push(`tool=${h}`),k.push("intent","edit",`${c.join(";")}?${i}`),k.join("/")}function X(e){let t=typeof e=="string"?e:e.baseUrl;return t!=="/"&&(t=t.replace(/\/$/,"")),typeof e=="string"?{baseUrl:t}:{...e,baseUrl:t}}const m=({sourcePath:e,value:t})=>{if(Q(t)||Y(t))return!1;const r=e.at(-1);return!(e.at(-2)==="slug"&&r==="current"||typeof r=="string"&&r.startsWith("_")||typeof r=="number"&&e.at(-2)==="marks"||r==="href"&&typeof e.at(-2)=="number"&&e.at(-3)==="markDefs"||r==="style"||r==="listItem"||e.some(n=>n==="meta"||n==="metadata"||n==="openGraph"||n==="seo")||typeof r=="string"&&F.has(r))},F=new Set(["color","colour","currency","email","format","gid","hex","href","hsl","hsla","icon","id","index","key","language","layout","link","linkAction","locale","lqip","page","path","ref","rgb","rgba","route","secret","slug","status","tag","template","theme","type","unit","url","username","variant","website"]);function Q(e){return/^\d{4}-\d{2}-\d{2}/.test(e)?!!Date.parse(e):!1}function Y(e){try{new URL(e,e.startsWith("/")?"https://acme.com":void 0)}catch{return!1}return!0}const w=20;function Z(e,t,r){var n,o,s,a,u,d,p,h,_;const{filter:y,logger:i,enabled:k}=r;if(!k){const l="config.enabled must be true, don't call this function otherwise";throw(n=i==null?void 0:i.error)==null||n.call(i,`[@sanity/client]: ${l}`,{result:e,resultSourceMap:t,config:r}),new TypeError(l)}if(!t)return(o=i==null?void 0:i.error)==null||o.call(i,"[@sanity/client]: Missing Content Source Map from response body",{result:e,resultSourceMap:t,config:r}),e;if(!r.studioUrl){const l="config.studioUrl must be defined";throw(s=i==null?void 0:i.error)==null||s.call(i,`[@sanity/client]: ${l}`,{result:e,resultSourceMap:t,config:r}),new TypeError(l)}const c={encoded:[],skipped:[]},T=G(e,t,({sourcePath:l,sourceDocument:g,resultPath:$,value:f})=>{if((typeof y=="function"?y({sourcePath:l,resultPath:$,filterDefault:m,sourceDocument:g,value:f}):m({sourcePath:l,resultPath:$,filterDefault:m,sourceDocument:g,value:f}))===!1)return i&&c.skipped.push({path:A(l),value:`${f.slice(0,w)}${f.length>w?"...":""}`,length:f.length}),f;i&&c.encoded.push({path:A(l),value:`${f.slice(0,w)}${f.length>w?"...":""}`,length:f.length});const{baseUrl:E,workspace:C,tool:O}=X(typeof r.studioUrl=="function"?r.studioUrl(g):r.studioUrl);if(!E)return f;const{_id:K,_type:L,_projectId:M,_dataset:N}=g;return W(f,{origin:"sanity.io",href:H({baseUrl:E,workspace:C,tool:O,id:K,type:L,path:l,...!r.omitCrossDatasetReferenceData&&{dataset:N,projectId:M}})},!1)});if(i){const l=c.skipped.length,g=c.encoded.length;if((l||g)&&((a=(i==null?void 0:i.groupCollapsed)||i.log)==null||a("[@sanity/client]: Encoding source map into result"),(u=i.log)==null||u.call(i,`[@sanity/client]: Paths encoded: ${c.encoded.length}, skipped: ${c.skipped.length}`)),c.encoded.length>0&&((d=i==null?void 0:i.log)==null||d.call(i,"[@sanity/client]: Table of encoded paths"),(p=(i==null?void 0:i.table)||i.log)==null||p(c.encoded)),c.skipped.length>0){const $=new Set;for(const{path:f}of c.skipped)$.add(f.replace(R,"0").replace(/\[\d+\]/g,"[]"));(h=i==null?void 0:i.log)==null||h.call(i,"[@sanity/client]: List of skipped paths",[...$.values()])}(l||g)&&((_=i==null?void 0:i.groupEnd)==null||_.call(i))}return T}function A(e){return x(I(e))}var et=Object.freeze({__proto__:null,stegaEncodeSourceMap:Z});export{G as encodeIntoResult,Z as stegaEncodeSourceMap,et as stegaEncodeSourceMap$1};
